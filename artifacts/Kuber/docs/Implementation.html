<!DOCTYPE html><html lang="en-US">
<!-- Mirrored from kubercostoptimizer.github.io/docs/Implementation by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 18 Jan 2022 22:01:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Implementation -</title><link rel="shortcut icon" href="../favicon.ico" type="image/x-icon"><link rel="stylesheet" href="../assets/css/just-the-docs.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2709176-10"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "UA-2709176-10"); </script> <script type="text/javascript" src="../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Implementation</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="Implementation" /><meta property="og:locale" content="en_US" /><meta name="description" content="A Jekyll theme for documentation" /><meta property="og:description" content="A Jekyll theme for documentation" /><link rel="canonical" href="Implementation.html" /><meta property="og:url" content="https://kubercostoptimizer.github.io/docs/Implementation" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Implementation" /> <script type="application/ld+json"> {"headline":"Implementation","description":"A Jekyll theme for documentation","url":"https://kubercostoptimizer.github.io/docs/Implementation","@type":"WebPage","@context":"https://schema.org"}</script><body><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="../index.html" class="site-title lh-tight"></a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="../index.html" class="navigation-list-link">Home</a><li class="navigation-list-item active"><a href="Implementation.html" class="navigation-list-link active">Implementation</a><li class="navigation-list-item"><a href="benchmarks.html" class="navigation-list-link">Benchmarks</a><li class="navigation-list-item"><a href="results.html" class="navigation-list-link">Results</a></ul></nav></div><footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4"></p><p class="text-small text-grey-dk-000 mb-4">More information will be available after the review process.</p></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><div class="search"><div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search " aria-label="Search " autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg></div><div class="js-search-results search-results-wrap"></div></div></div><div class="page"><div id="main-content" class="page-content" role="main"><h2 id="the-source-code-of-our-framework-is-available-on-github"> <a href="#the-source-code-of-our-framework-is-available-on-github" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> The source code of our framework is available on <a href="https://github.com/kubercostoptimizer/Kuber/tree/master/code">GitHub</a>.</h2><h2 id="docker-container-with-all-the-dependencies-is-at-docker-hub"> <a href="#docker-container-with-all-the-dependencies-is-at-docker-hub" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Docker container with all the dependencies is at <a href="https://hub.docker.com/r/kuberload/kuber">Docker Hub</a></h2><hr /><h2 id="prerequisites-for-running"> <a href="#prerequisites-for-running" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Prerequisites for Running</h2><ol><li>A working OpenNebula Cluster: for creating VMs. Installation instructions are available <a href="https://docs.opennebula.io/5.12/deployment/index.html">here</a>.<li>A <a href="https://hub.docker.com/">DockerHub</a> account: stores appsâ€™ Docker images for Kubernetes to deploy.</ol><hr /><h2 id="code-structure"> <a href="#code-structure" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Code Structure</h2><p>The code is found in <a href="https://github.com/kubercostoptimizer/Kuber/tree/master/code">Github</a> and is arranged in the following packages:</p><ol><li><a href="https://github.com/kubercostoptimizer/Kuber/tree/master/code/Infrastructure">Infrastructure</a>: handles low-level functions<ul><li>Uses OpenNebula API to creates VMs of required type.<li>Deploys Kubernetes on to VMs or adds new VM.<li>Deploys combinations using Kubernetes API.</ul><li><a href="https://github.com/kubercostoptimizer/Kuber/tree/master/code/Profiler">Profiler</a>: Executes a combination on a VM type<ul><li>Creates initial cluster needed for all services in the app.<li>Uses the Infrastructure package to place the service combination on the test VM.<li>Loads the databases for the app.<li>Loads tests of the app and extracts performance data from the Istio logs.</ul><li><a href="https://github.com/kubercostoptimizer/Kuber/tree/master/code/kuber">Kuber</a>: code of the Combination Selector and Deployment Planner components.<li><a href="https://github.com/kubercostoptimizer/Kuber/tree/master/code/SSOT">SSOT</a>: Configuration information about VM types and services.<li><a href="https://github.com/kubercostoptimizer/Kuber/tree/master/code/apps">Apps</a>: Application deployment files and load tests.</ol><hr /><h2 id="configuration"> <a href="#configuration" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Configuration</h2><p>Kuber needs the following information to be provided by the application developer:</p><h3 id="data-about-the-application"> <a href="#data-about-the-application" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Data about the application</h3><ol><li>Kubernetes deployment files (.yamls) for deploying services and their dependencies.<ul><li>place all the deployment files in /apps/app_name/deploy folder.</ul><li>Load test to execute.<ul><li>copy existing load_test folder from /apps/sock-shop/load_test<li>update /apps/app_name/load_test/locustfile.py with required test scenario.</ul><li>Initial load, e.g., for databases<ul><li>create a folder apps/app_name/load_test/init_scripts/<li>Copy the code the initializes the application.<li>Create a file run.sh and modify the file to invoke the code from it.<li>Example: if initialization script is a python code init.py, add a line to run.sh:<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">python</span> <span class="n">init</span><span class="p">.</span><span class="n">py</span>
</code></pre></div></div></ul></ol><h3 id="ssot-single-source-of-truth"> <a href="#ssot-single-source-of-truth" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> SSOT: Single Source Of Truth</h3><p>Application developers have to configure VM types and services that need to be tested in file SSOT/config.json. Example config.json file is in the SSOT folder. Below we explain in detail each of the config options:</p><div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Application"</span><span class="p">:</span><span class="w"> 
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app_name"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"services"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"service1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"service2"</span><span class="p">],</span><span class="w">
          </span><span class="nl">"front-end"</span><span class="p">:</span><span class="w"> </span><span class="s2">"service1"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5000"</span><span class="w">
      </span><span class="p">},</span><span class="w">
  </span><span class="nl">"Profiling"</span><span class="p">:</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"load_gen"</span><span class="p">:</span><span class="w">
          </span><span class="p">{</span><span class="w">
           </span><span class="nl">"time_limit"</span><span class="p">:</span><span class="s2">"2m"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"concurrent"</span><span class="p">:</span><span class="s2">"100"</span><span class="w">
          </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
  </span><span class="nl">"Infrastructure"</span><span class="p">:</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Cloud_provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"opennebula"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"vm_types"</span><span class="p">:[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"name"</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="s2">"m4.large"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"cpu_count"</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ram"</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">"8"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"computer"</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="s2">"leibnitz"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"price"</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="mf">0.10</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"name"</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="s2">"m4.xlarge"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"cpu_count"</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ram"</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="s2">"16"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"computer"</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="s2">"leibnitz"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"price"</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="mf">0.20</span><span class="w">
                </span><span class="p">},</span><span class="w">
              </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div><ol><li>Application<ul><li>name: the name of the application (should be same as the namespace given in Kubernetes deployment files and the folder name in /apps).<li>services: names of each microservice, should be the same as in the Kubernetes services in /apps/app_name/deploy.<li>front-end: service that receives external traffic for the application.<li>port: port exposed by front-end.</ul><li>Profiling<ul><li>time_limit: the amount of time to run each load test.<li>concurrent: number of concurrent users for the test.</ul><li>VM types: a list where each entry corresponds to a VM type and contains<ul><li>name: user-given name for the VM type<li>cpu_count: number of CPU cores<li>ram: RAM size in GB<li>price: cost per hour in $<li>computer: a physical machine to place the VM on, i.e., a hostname in OpenNebula cluster.</ul></ol><hr /><h2 id="running-the-kuber-with-docker-container"> <a href="#running-the-kuber-with-docker-container" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewBox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Running the Kuber with Docker container</h2><ul><li>Download the docker container from the <a href="https://hub.docker.com/r/kuberload/kuber">DockerHub</a> and the code from <a href="https://github.com/kubercostoptimizer/Kuber/tree/master/code">GitHub </a>.<li>Run the docker container with code using the following command:</ul><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-v</span> /code:/wd/code kuberload/kuber:latest /bin/bash
</code></pre></div></div><ul><li>Update login credentials for OpenNebula Cluster and DockerHub</ul><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#OpenNebula Cluster Credentials</span>
<span class="nb">export </span><span class="nv">USERNAME</span><span class="o">=</span> xxxx <span class="c">#OpenNebula username</span>
<span class="nb">export </span><span class="nv">PASSWORD</span><span class="o">=</span> xxxxx <span class="c">#OpenNebula password</span>
<span class="nb">export </span><span class="nv">USERID</span><span class="o">=</span> xxxx <span class="c">#OpenNebula userid</span>

<span class="c">#DockerHub Credentials</span>
<span class="nb">export </span><span class="nv">DOCKERID</span><span class="o">=</span> xxxx <span class="c">#DockerHub username</span>
<span class="nb">export </span><span class="nv">DOCKERPASS</span><span class="o">=</span> xxxx <span class="c">#DockerHub password</span>
<span class="nb">export </span><span class="nv">DOCKERMAIL</span><span class="o">=</span> xxxx <span class="c">#DockerHub mail</span>
</code></pre></div></div><ul><li>Finally, execute the Kuber inside the container:</ul><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /wd/code/kuber
python run.py
</code></pre></div></div></div></div></div></div>
